<!DOCTYPE html>
<html lang="de">
<!--
    MoltBot Organizer / Pear App
    Copyright ¬© 2026 Andrea Agnello, Pear Company, Deutschland
    All rights reserved.
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="author" content="Andrea Agnello, Pear Company">
    <meta name="copyright" content="Copyright ¬© 2026 Andrea Agnello, Pear Company, Deutschland">
    <title>Pear App | Smart Team Sync</title>
    <meta name="description"
        content="Der intelligente Team-Organizer mit Echtzeit-Synchronisation f√ºr Termine und Kalender.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- PWA / Mobile Icon -->
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0c10">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDKs are loaded in app.js via modules or CDNs there if needed, 
         but here we use the CDN script tags for simplicity if not using bundler -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style_table.css">
    <link rel="stylesheet" href="style_create_menu.css">
    <link rel="stylesheet" href="lifestyle-calendar.css">
    <link rel="stylesheet" href="enhanced-dashboard.css">
    <link rel="stylesheet" href="premium-todo.css">

    <!-- FIX: Ensure map-pin icon works by including it if not already handled by lucide script -->
</head>

<body data-theme="dark">
    <!-- SPLASH SCREEN -->
    <div id="splash-screen"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #18181b; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.6s ease-out, visibility 0.6s;">
        <svg width="120" height="120" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"
            style="filter: drop-shadow(0 0 20px rgba(255,255,255,0.2)); animation: pulse-logo 2s infinite;">
            <defs>
                <linearGradient id="rainbowGradSplash" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#FF0000;stop-opacity:1" />
                    <stop offset="16%" style="stop-color:#FF7F00;stop-opacity:1" />
                    <stop offset="33%" style="stop-color:#FFFF00;stop-opacity:1" />
                    <stop offset="50%" style="stop-color:#00FF00;stop-opacity:1" />
                    <stop offset="66%" style="stop-color:#0000FF;stop-opacity:1" />
                    <stop offset="83%" style="stop-color:#4B0082;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#8B00FF;stop-opacity:1" />
                </linearGradient>
                <mask id="biteMaskSplash">
                    <rect width="100" height="100" fill="white" />
                    <circle cx="78" cy="40" r="18" fill="black" />
                </mask>
            </defs>
            <path d="M50,10 C30,10 20,40 20,65 C20,90 35,95 50,95 C65,95 80,90 80,65 C80,40 70,10 50,10 Z"
                fill="url(#rainbowGradSplash)" mask="url(#biteMaskSplash)" />
            <path d="M50,10 Q50,0 60,5 C55,8 52,10 50,10" fill="url(#rainbowGradSplash)" />
        </svg>
        <h1
            style="margin-top: 20px; font-family: 'Outfit', sans-serif; font-weight: 700; color: white; letter-spacing: 1px;">
            Pear</h1>
    </div>

    <div id="app">
        <!-- Navigation -->
        <nav class="sidebar" id="sidebar">

            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="rainbowGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FF0000;stop-opacity:1" />
                            <stop offset="16%" style="stop-color:#FF7F00;stop-opacity:1" />
                            <stop offset="33%" style="stop-color:#FFFF00;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#00FF00;stop-opacity:1" />
                            <stop offset="66%" style="stop-color:#0000FF;stop-opacity:1" />
                            <stop offset="83%" style="stop-color:#4B0082;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#8B00FF;stop-opacity:1" />
                        </linearGradient>
                        <mask id="biteMask">
                            <rect width="100" height="100" fill="white" />
                            <circle cx="78" cy="40" r="18" fill="black" />
                        </mask>
                    </defs>
                    <path d="M50,10 C30,10 20,40 20,65 C20,90 35,95 50,95 C65,95 80,90 80,65 C80,40 70,10 50,10 Z"
                        fill="url(#rainbowGrad)" mask="url(#biteMask)" />
                    <path d="M50,10 Q50,0 60,5 C55,8 52,10 50,10" fill="url(#rainbowGrad)" />
                </svg>
                <span id="sidebarAppName">Pear</span>
            </div>

            <div class="nav-items">
                <button class="nav-item active" data-page="dashboard" onclick="app.navigateTo('dashboard')">
                    <i data-lucide="layout-dashboard"></i> <span>Dashboard</span>
                </button>
                <button class="nav-item" data-page="calendar" onclick="app.navigateTo('calendar')">
                    <i data-lucide="calendar"></i> <span>Kalender</span>
                </button>
                <button class="nav-item" data-page="contacts" onclick="app.navigateTo('contacts')">
                    <i data-lucide="contact"></i> <span>Kontakte</span>
                </button>
                <button class="nav-item" data-page="todo" onclick="app.navigateTo('todo')">
                    <i data-lucide="check-square"></i> <span>Aufgaben</span>
                </button>
                <button class="nav-item" data-page="finance" onclick="app.navigateTo('finance')">
                    <i data-lucide="wallet"></i> <span>Finanzen</span>
                </button>
                <button class="nav-item" data-page="alarm" onclick="app.navigateTo('alarm')">
                    <i data-lucide="clock"></i> <span>Wecker</span>
                </button>
                <button class="nav-item" data-page="team" onclick="app.navigateTo('team')">
                    <i data-lucide="users"></i> <span>Team Sync</span>
                </button>
                <button class="nav-item" data-page="settings" onclick="app.navigateTo('settings')">
                    <i data-lucide="settings"></i> <span>Einstell.</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <!-- Mobile Header (Minimalist) -->
            <header class="top-bar mobile-only"
                style="justify-content: space-between; align-items: center; display: flex; padding: 10px 20px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button id="mobileBackBtn" class="icon-btn hidden" title="Zur√ºck zum Dashboard"
                        onclick="app.navigateTo('dashboard')"
                        style="background: rgba(var(--primary-rgb), 0.1); color: var(--primary); border: 1px solid var(--glass-border); width: 38px; height: 38px;">
                        <i data-lucide="arrow-left" size="20"></i>
                    </button>
                    <button id="mobileMenuBtn" class="icon-btn" title="Men√º √∂ffnen"
                        onclick="document.getElementById('sidebar').classList.add('active')"
                        style="background: rgba(var(--primary-rgb), 0.1); color: var(--primary); border: 1px solid var(--glass-border); width: 38px; height: 38px;">
                        <i data-lucide="menu" size="20"></i>
                    </button>
                    <div style="font-weight: 800; font-size: 1.2rem; color: var(--primary);">Pear</div>
                </div>

                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="avatar" style="width: 38px; height: 38px;" onclick="app.navigateTo('settings')">
                        <img id="headerUserAvatarMobile" src="logo.svg"
                            style="width:100%; height:100%; object-fit:cover; border-radius:50%;">
                    </div>
                </div>
            </header>


            <header class="top-bar mobile-hidden">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button id="desktopBackBtn" class="icon-btn hidden" title="Zur√ºck zum Dashboard"
                        onclick="app.navigateTo('dashboard')"
                        style="background: rgba(var(--primary-rgb), 0.1); color: var(--primary); border: 1px solid var(--glass-border); width: 32px; height: 32px;">
                        <i data-lucide="arrow-left" size="18"></i>
                    </button>
                    <div class="search-bar">
                        <i data-lucide="search"></i>
                        <input type="text" placeholder="Suche nach Terminen, Aufgaben...">
                    </div>
                </div>

                <div class="user-actions">
                    <button class="icon-btn" title="Sprachsteuerung" onclick="app.voice.start()">
                        <i data-lucide="mic"></i>
                    </button>
                    <!-- Notifications? -->

                    <div id="syncIndicator" class="sync-status-indicator" onclick="app.navigateTo('team')"
                        style="display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 20px; cursor: pointer; border: 1px solid var(--glass-border); margin-right: 10px;">
                        <span class="status-dot"
                            style="width: 8px; height: 8px; border-radius: 50%; background: #666;"></span>
                        <span id="syncStatusText"
                            style="font-size: 0.75rem; font-weight: 600; color: var(--text-muted);">Lokal</span>
                    </div>



                    <div class="user-info-mini"
                        style="display: flex; flex-direction: column; align-items: flex-end; margin-right: 10px;">
                        <span id="headerUserName" style="font-weight: 600; font-size: 0.9rem;">User</span>
                        <small class="text-muted" style="font-size: 0.7rem;">Organizer</small>
                    </div>
                    <div class="avatar" id="userAvatar">
                        <img id="headerUserAvatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=User"
                            alt="User">
                    </div>
                </div>
            </header>

            <!-- Views -->
            <section id="view-dashboard" class="page-view active">
                <div class="hero dashboard-hero">
                    <div class="hero-info-pills">
                        <div class="info-pill highlight">
                            <i data-lucide="clock"></i>
                            <span id="dashClock">--:--</span>
                        </div>
                        <div class="info-pill highlight">
                            <i data-lucide="calendar"></i>
                            <span id="dashDate">---, --. ---</span>
                        </div>
                        <div class="info-pill highlight">
                            <i data-lucide="thermometer" class="mobile-only-inline"></i>
                            <i data-lucide="map-pin" class="mobile-hide"></i>
                            <span id="dashLocation" class="mobile-hide">Ort...</span>
                            <span id="dashTemp">--¬∞C</span>
                        </div>
                    </div>

                    <div class="hero-main-row">
                        <div class="hero-text">
                            <h1 id="dashboardWelcomeTitle">Willkommen zur√ºck! üëã</h1>
                            <p>Hier ist eine √úbersicht deiner n√§chsten Termine.</p>
                        </div>
                        <button class="btn-hero-action animate-in" id="dashboardCreateBtn"
                            onclick="app.toggleCreateMenu(this)">
                            <div class="icon-circle">
                                <i data-lucide="plus"></i>
                            </div>
                            <div class="btn-label">
                                <span class="main-label">Neu</span>
                                <span class="sub-label">Erstellen</span>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Statically defined widgets removed. Now dynamically rendered by app.js based on widgetOrder. -->
                </div>

            </section>

            <section id="view-calendar" class="page-view">
                <div class="calendar-container">
                    <!-- Calendar Sidebar -->
                    <aside class="calendar-sidebar glass is-collapsed-mobile" id="calendarSidebar">
                        <div class="calendar-sidebar-toggle-header" onclick="app.toggleCalendarSidebar()">
                            <h3>Kalender Optionen</h3>
                            <i data-lucide="chevron-down" class="sidebar-toggle-icon"></i>
                        </div>
                        <div class="calendar-sidebar-content">
                            <button class="btn-primary create-btn" id="sidebarCreateBtn">
                                <i data-lucide="plus"></i> Erstellen
                            </button>

                            <div class="mini-calendar-container">
                                <div class="mini-calendar-header">
                                    <span id="sidebarMiniMonth">Februar 2026</span>
                                    <div class="mini-nav">
                                        <button onclick="app.calendar.prevMini()"><i
                                                data-lucide="chevron-left"></i></button>
                                        <button onclick="app.calendar.nextMini()"><i
                                                data-lucide="chevron-right"></i></button>
                                    </div>
                                </div>
                                <div class="calendar-grid small" id="sidebarMiniGrid">
                                    <!-- Populated by JS -->
                                </div>
                            </div>

                            <div class="calendar-filters">
                                <h4>Meine Kalender</h4>
                                <div class="filter-item">
                                    <input type="checkbox" id="filter-work" checked>
                                    <label for="filter-work"><span class="dot work"></span> Arbeit</label>
                                </div>
                                <div class="filter-item">
                                    <input type="checkbox" id="filter-private" checked>
                                    <label for="filter-private"><span class="dot private"></span> Privat</label>
                                </div>
                                <div class="filter-item">
                                    <input type="checkbox" id="filter-urgent" checked>
                                    <label for="filter-urgent"><span class="dot urgent"></span> Dringend</label>
                                </div>
                                <div class="filter-item">
                                    <input type="checkbox" id="filter-birthday" checked>
                                    <label for="filter-birthday"><span class="dot" style="background:#ffd700"></span>
                                        Geburtstage üéÇ</label>
                                </div>
                                <div class="filter-item">
                                    <input type="checkbox" id="filter-holiday" checked>
                                    <label for="filter-holiday"><span class="dot" style="background:#ff9f43"></span>
                                        Feiertage üéä</label>
                                </div>
                                <div class="filter-item">
                                    <input type="checkbox" id="filter-archive">
                                    <label for="filter-archive"><span class="dot" style="background:#6c757d"></span>
                                        Archiv anzeigen üì¶</label>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <!-- Main Calendar Area -->
                    <div class="calendar-main glass">
                        <header class="calendar-header-pro">
                            <div class="header-left">
                                <button class="btn-outline" onclick="app.calendar.goToday()">Heute</button>
                                <div class="nav-controls">
                                    <button id="prevMonth" class="icon-btn"><i data-lucide="chevron-left"></i></button>
                                    <button id="nextMonth" class="icon-btn"><i data-lucide="chevron-right"></i></button>
                                </div>
                                <h2 id="fullCalendarMonth">Februar 2026</h2>
                                <button class="icon-btn" onclick="app.editEvent()" title="Termin erstellen"
                                    style="margin-left: 15px; background: rgba(var(--primary-rgb), 0.1); color: var(--primary); border: 1px solid var(--glass-border); width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">
                                    <i data-lucide="plus" size="24"></i>
                                </button>
                                <button class="icon-btn" id="monthLayoutToggle" onclick="app.toggleCalendarLayout()"
                                    title="Ansicht wechseln" style="display:none; margin-left:10px;">
                                    <i data-lucide="grid"></i>
                                </button>
                            </div>
                            <div class="header-right">
                                <div class="view-selector" id="calendarViewSelector">
                                    <button data-view="day">Tag</button>
                                    <button data-view="week">Woche</button>
                                    <button data-view="month" class="active">Monat</button>
                                    <button data-view="year">Jahr</button>
                                </div>
                            </div>
                        </header>
                        <div class="calendar-body">
                            <div class="weekday-header" id="weekdayHeader">
                                <!-- Mo, Di, Mi... -->
                            </div>
                            <div class="calendar-grid-large" id="fullCalendarGrid">
                                <!-- Full calendar -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Finance View -->
            <section id="view-finance" class="page-view">
                <div class="hero" style="position: relative;">
                    <h1>Finanzplaner üí∞</h1>
                    <p>Behalte deine Ausgaben und dein Budget im Griff.</p>

                    <!-- Quick Add Button -->
                    <button class="finance-quick-add-btn" onclick="app.finance.openQuickAdd()"
                        title="Schnell Ausgabe/Einnahme hinzuf√ºgen"
                        style="position: absolute; top: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); border: none; color: white; font-size: 2rem; font-weight: 300; cursor: pointer; box-shadow: 0 8px 20px rgba(var(--primary-rgb), 0.4); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; z-index: 10;">
                        +
                    </button>
                </div>

                <!-- Hero Stats (Actionable Reality) -->
                <div class="dashboard-grid" style="margin-bottom: 30px;">
                    <div class="card glass"
                        style="background: rgba(var(--primary-rgb), 0.08); border: 2px solid var(--primary); grid-column: 1 / -1; padding: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <small class="text-muted"
                                    style="text-transform: uppercase; letter-spacing: 1px; font-weight: 700;">Heute
                                    verf√ºgbar (Tageslimit) ‚ö°</small>
                                <h2 id="finDailyLimit"
                                    style="font-weight: 900; font-size: 2.8rem; color: var(--primary); margin: 10px 0;">
                                    0,00 ‚Ç¨</h2>
                                <small id="finDaysLeft" class="text-muted"
                                    style="font-size: 0.85rem; font-style: italic;">noch X Tage im Monat</small>
                            </div>
                            <div class="icon-circle"
                                style="width: 70px; height: 70px; background: rgba(var(--primary-rgb), 0.1); color: var(--primary);">
                                <i data-lucide="zap" size="32"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card glass"
                        style="background: rgba(var(--success-rgb), 0.05); border: 1px solid rgba(var(--success-rgb), 0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <small class="text-muted">Verf. f√ºr restl. Monat üóìÔ∏è</small>
                            <button class="btn-text highlight"
                                style="font-size: 0.65rem; padding: 2px 8px; background: rgba(var(--success-rgb), 0.1); border-radius: 6px; color: var(--success);"
                                onclick="app.finance.depositToSavings(parseFloat(document.getElementById('finDailyAvailable').textContent.replace(/[^-0-9,]/g, '').replace(',', '.')))">
                                <i data-lucide="arrow-up-right" size="10"></i> Sparen
                            </button>
                        </div>
                        <h2 id="finDailyAvailable" style="font-weight: 800; color: var(--success);">0,00 ‚Ç¨</h2>
                    </div>

                    <div class="card glass"
                        style="background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.1), rgba(0,0,0,0)); border: 1px solid var(--primary);">
                        <small class="text-muted">Virtuelles Sparkonto üè¶</small>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <h2 id="finSavingsBalance" style="color: var(--primary); font-weight: 800;">0,00 ‚Ç¨</h2>
                            <button class="btn-icon" onclick="app.finance.editSavingsBalance()"
                                title="Kontostand anpassen">
                                <i data-lucide="edit-3" size="14"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Strategic Planning & Details (Collapsible to reduce clutter) -->
                <div class="card glass collapsible-card is-collapsed"
                    style="margin-bottom: 25px; border: 1px solid var(--glass-border);">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="line-chart" size="18" class="text-primary"></i>
                            <span style="font-weight: 600;">Planung & Monats-Details</span>
                        </div>
                        <i data-lucide="chevron-down" class="toggle-icon" size="20"></i>
                    </div>
                    <div class="card-content">
                        <div class="dashboard-grid"
                            style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;">
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Einnahmen (Gehalt)</small>
                                <h3 id="finTotalIncome"
                                    style="color: var(--success); font-weight: 700; margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Fixkosten</small>
                                <h3 id="finFixedPlanDisplay"
                                    style="color: var(--danger); font-weight: 700; margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Netto (nach Fixkosten)</small>
                                <h3 id="finNetto" style="font-weight: 700; margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Variable Ausgaben (Alltag)</small>
                                <h3 id="finVariableExpenses"
                                    style="color: var(--danger); font-weight: 700; margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Monats-Ausgaben (Gesamt)</small>
                                <h3 id="finTotalExpenses"
                                    style="color: var(--danger); font-weight: 700; margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Sparziel (Reserve)</small>
                                <div style="display:flex; align-items:center; gap:8px;">
                                    <h3 id="finSavingsGoal" style="color: var(--warning); margin-top: 5px;">0,00 ‚Ç¨</h3>
                                    <button class="btn-icon" onclick="app.finance.editSavingsGoal()"
                                        style="width: 24px; height: 24px;"><i data-lucide="edit-3"
                                            size="12"></i></button>
                                </div>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Monatsbudget (Limit)</small>
                                <div style="display:flex; align-items:center; gap:8px;">
                                    <h3 id="finTotalBudget" style="margin-top: 5px;">0,00 ‚Ç¨</h3>
                                    <button class="btn-icon" onclick="app.finance.editBudget()"
                                        style="width: 24px; height: 24px;"><i data-lucide="edit-3"
                                            size="12"></i></button>
                                </div>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Warn-Schwelle ‚ö†Ô∏è</small>
                                <div style="display:flex; align-items:center; gap:8px;">
                                    <h3 id="finWarningLimit" style="color: var(--warning); margin-top: 5px;">0,00 ‚Ç¨</h3>
                                    <button class="btn-icon" onclick="app.finance.editBudgetWarning()"
                                        style="width: 24px; height: 24px;"><i data-lucide="bell" size="12"></i></button>
                                </div>
                            </div>
                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Verbl. Budget-Limit</small>
                                <h3 id="finRemaining" style="margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>

                            <div class="card glass" style="padding: 15px; background: rgba(255,255,255,0.02);">
                                <small class="text-muted">Jahresbilanz</small>
                                <h3 id="finYearTotal" style="margin-top: 5px;">0,00 ‚Ç¨</h3>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-bottom: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="trending-up" size="18" class="text-primary"></i>
                            <span style="font-weight: 600;">Kurz√ºbersicht (Tag/Woche)</span>
                        </div>
                        <i data-lucide="chevron-down" class="toggle-icon" size="20"></i>
                    </div>
                    <div class="card-content">
                        <div id="finExtraStats" class="dashboard-grid" style="margin-top: 15px; gap: 15px;">
                            <div class="card glass" style="border: 1px solid var(--glass-border); padding: 15px;">
                                <small class="text-muted">Ausgaben heute</small>
                                <h3 id="finTodayTotal">0,00 ‚Ç¨</h3>
                            </div>
                            <div class="card glass" style="border: 1px solid var(--glass-border); padding: 15px;">
                                <small class="text-muted">Ausgaben diese Woche</small>
                                <h3 id="finWeekTotal" style="color: var(--danger);">0,00 ‚Ç¨</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-bottom: 25px;">
                    <div class="card-header-toggle"
                        style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                        <div style="display: flex; align-items: center; gap: 10px;"
                            onclick="app.toggleCard(this.parentElement)">
                            <i data-lucide="repeat" size="18" class="text-secondary"></i>
                            <span style="font-weight: 600;">Regelm√§√üige Fixkosten (Vorlagen) üè†</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-icon" onclick="app.finance.createBaseTemplates()"
                                title="Standard-Vorlagen laden"
                                style="background: rgba(var(--primary-rgb), 0.1); border-radius: 8px; padding: 4px 8px; width: auto; height: auto; font-size: 0.75rem; display: flex; align-items: center; gap: 5px;">
                                <i data-lucide="zap" size="12"></i> Setup
                            </button>
                            <i data-lucide="chevron-down" class="toggle-icon" size="20"
                                onclick="app.toggleCard(this.parentElement.parentElement)"></i>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="margin-top: 15px;">
                            <div
                                style="display: grid; grid-template-columns: 1fr 120px 100px; gap: 10px; margin-bottom: 15px;">
                                <input type="text" id="fixedCostName" placeholder="Name (z.B. Miete)"
                                    style="width:100%;">
                                <input type="number" id="fixedCostAmount" step="0.01" placeholder="Betrag ‚Ç¨"
                                    style="width:100%;">
                                <select id="fixedCostType"
                                    style="width:100%; border-radius:12px; padding:0 10px; background:var(--bg-solid-2); border:1px solid var(--glass-border); color:var(--text-main);">
                                    <option value="expense">Ausgabe</option>
                                    <option value="income">Einnahme</option>
                                </select>
                            </div>
                            <button class="btn-primary w-full" onclick="app.finance.addFixedCost()"
                                style="margin-bottom: 25px;">Vorlage hinzuf√ºgen</button>

                            <h4 style="font-size: 0.9rem; margin-bottom: 15px; opacity: 0.8;">Gespeicherte Vorlagen</h4>
                            <div id="fixedCostsList"
                                style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px;">
                                <!-- JS populated -->
                            </div>

                            <div style="border-top: 1px solid var(--glass-border); padding-top: 20px;">
                                <button class="btn-primary w-full" onclick="app.finance.applyFixedCosts()"
                                    style="background: var(--secondary); border: none; height: 55px; border-radius: 16px;">
                                    <i data-lucide="zap" size="18" style="margin-right: 8px;"></i> Alle Fixkosten jetzt
                                    buchen
                                </button>
                                <p class="text-muted"
                                    style="font-size: 0.75rem; margin-top: 12px; text-align: center; font-style: italic;">
                                    Ein Klick wandelt alle Vorlagen in echte Eintr√§ge f√ºr den aktuellen Monat um.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card glass">
                        <h3>Ausgabe hinzuf√ºgen</h3>
                        <form id="financeForm" onsubmit="app.finance.addEntry(event)" style="margin-top: 15px;">
                            <div class="form-row" style="display: flex; gap: 15px;">
                                <div class="form-group" style="flex: 1;">
                                    <label>Betrag (‚Ç¨)</label>
                                    <input type="number" id="finAmount" step="0.01" placeholder="0.00" required>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label>Datum</label>
                                    <input type="date" id="finDate" required>
                                </div>
                            </div>
                            <div class="form-row" style="display: flex; gap: 15px; margin-top: 10px;">
                                <div class="form-group" style="flex: 1;">
                                    <label>Typ</label>
                                    <select id="finType"
                                        style="width: 100%; border-radius: 12px; padding: 12px; background: rgba(var(--bg-solid-2-rgb), 0.5); border: 1px solid var(--glass-border); color: var(--text-main);">
                                        <option value="expense">Ausgabe üîª</option>
                                        <option value="income">Einnahme üîº</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label>Beschreibung / Zweck</label>
                                    <input type="text" id="finSource" placeholder="z.B. Gehalt, Miete, Hobby..."
                                        required>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary w-full"
                                style="margin-top: 15px;">Eintragen</button>
                        </form>
                    </div>

                    <div class="card glass">
                        <h3>Ausgaben & Trends</h3>
                        <div style="height: 250px; position: relative;">
                            <canvas id="financeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card glass" style="margin-top: 25px;">
                    <div class="card-header">
                        <h3>Transaktionsverlauf</h3>
                        <button class="btn-text" onclick="app.finance.clearAll()">Verlauf l√∂schen</button>
                    </div>
                    <div class="transaction-history-container"
                        style="max-height: 500px; overflow-y: auto; overflow-x: auto; scrollbar-width: thin; scrollbar-color: var(--primary) transparent;">
                        <table class="contact-table" style="margin-bottom: 0;">
                            <thead>
                                <tr style="position: sticky; top: 0; background: var(--bg-card); z-index: 10;">
                                    <th>Datum</th>
                                    <th>Zweck</th>
                                    <th>Betrag</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody id="financeTableBody">
                                <!-- JS populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="view-team" class="page-view">
                <div class="team-login-container" style="max-width: 500px; margin: 60px auto; text-align: center;">
                    <div class="card glass animate-in" style="padding: 40px;">
                        <div class="icon-circle"
                            style="width: 80px; height: 80px; background: rgba(var(--primary-rgb), 0.1); margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 2px solid var(--glass-border);">
                            <i data-lucide="cloud-lightning" size="32" style="color: var(--primary);"></i>
                        </div>
                        <h2>Team Login & Synchronisation</h2>
                        <p class="text-muted" style="margin-bottom: 30px;">Verbinde dich mit deinem Team, um deine Daten
                            in Echtzeit auf allen Ger√§ten zu synchronisieren.</p>

                        <div class="login-fields"
                            style="text-align: left; display: flex; flex-direction: column; gap: 15px;">
                            <div class="form-group">
                                <label
                                    style="margin-bottom: 5px; display: block; font-weight: 600; font-size: 0.9rem;">Dein
                                    Name</label>
                                <input type="text" id="userInput" placeholder="Z.B. Max"
                                    style="width: 100%; padding: 12px; background: #ffffff; color: #000000; border: 1px solid var(--glass-border); border-radius: 12px; font-size: 1rem;">
                            </div>
                            <div class="form-group">
                                <label
                                    style="margin-bottom: 5px; display: block; font-weight: 600; font-size: 0.9rem;">Team-Schl√ºssel</label>
                                <input type="text" id="teamInput" placeholder="Z.B. MeinTeam2026"
                                    style="width: 100%; padding: 15px; background: #ffffff; color: #000000; border: 1px solid var(--glass-border); border-radius: 12px; font-size: 1.1rem;">
                            </div>
                            <div class="form-group">
                                <label style="margin-bottom: 8px; display: block; font-weight: 600;">Privat-PIN
                                    (4-stellig)</label>
                                <div style="position: relative;">
                                    <input type="password" id="teamPin" maxlength="4" placeholder="****"
                                        style="width: 100%; padding: 15px; background: #ffffff; color: #000000; border: 1px solid var(--glass-border); border-radius: 12px; font-size: 1.1rem; letter-spacing: 5px; text-align: center;">
                                    <button onclick="app.sync.togglePinVisibility()"
                                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #666; cursor: pointer;">
                                        <i data-lucide="eye" size="20" id="pinToggleIcon"></i>
                                    </button>
                                </div>
                            </div>
                            <button class="btn-primary w-full" onclick="app.sync.connect()"
                                style="height: 55px; font-size: 1.1rem;">
                                <i data-lucide="shuffle"></i> Synchronisation Starten
                            </button>
                        </div>

                        <!-- Add a clear option for new accounts as requested -->
                        <div
                            style="margin-top: 25px; padding-top: 20px; border-top: 1px dashed var(--glass-border); text-align: center;">
                            <p class="text-muted" style="font-size: 0.85rem; margin-bottom: 12px;">Noch kein Team?</p>
                            <button class="btn-outline w-full" onclick="app.createNewTeamAccount()"
                                style="border-style: dashed; border-color: var(--primary); height: 50px;">
                                <i data-lucide="plus-circle" size="18"></i> Neues Team-Konto erstellen
                            </button>
                        </div>

                        <div id="activeSyncInfo" class="hidden"
                            style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--glass-border); text-align: left;">

                            <div class="team-header"
                                style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
                                <div>
                                    <h3 style="margin: 0; font-size: 1.4rem;">Teamverwaltung</h3>
                                    <div
                                        style="display: flex; align-items: center; gap: 8px; color: var(--success); font-weight: 600; margin-top: 5px;">
                                        <i data-lucide="shield-check" size="16"></i>
                                        <span id="currentTeamDisplay">---</span>
                                    </div>
                                </div>
                                <button class="btn-text" style="color: var(--danger); font-size: 0.85rem; padding: 0;"
                                    onclick="app.sync.disconnect()">Abmelden</button>
                            </div>

                            <div class="team-stats-row"
                                style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                                <div class="stat-mini-card"
                                    style="background: rgba(var(--primary-rgb), 0.05); padding: 15px; border-radius: 16px; border: 1px solid var(--glass-border);">
                                    <small class="text-muted"
                                        style="display: block; margin-bottom: 5px;">Termine</small>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i data-lucide="calendar" size="18" style="color: var(--primary);"></i>
                                        <h4 id="teamEventCount" style="margin: 0; font-size: 1.2rem;">0</h4>
                                    </div>
                                </div>
                                <div class="stat-mini-card"
                                    style="background: rgba(var(--secondary-rgb), 0.05); padding: 15px; border-radius: 16px; border: 1px solid var(--glass-border);">
                                    <small class="text-muted"
                                        style="display: block; margin-bottom: 5px;">Aufgaben</small>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i data-lucide="check-circle" size="18" style="color: var(--secondary);"></i>
                                        <h4 id="teamTodoCount" style="margin: 0; font-size: 1.2rem;">0</h4>
                                    </div>
                                </div>
                            </div>

                            <div class="members-section" style="margin-bottom: 25px;">
                                <h4
                                    style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                    <i data-lucide="users" size="16"></i>
                                    Team-Mitglieder (Online)
                                </h4>
                                <div id="presenceList" class="online-members">
                                    <!-- JS populated -->
                                    <p class="text-muted" style="font-size: 0.8rem; font-style: italic;">Suche nach
                                        Mitgliedern...</p>
                                </div>
                            </div>

                            <div class="sync-actions"
                                style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 20px; border: 1px solid var(--glass-border);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <span style="font-size: 0.9rem; font-weight: 600;">System-Status</span>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span id="currentPinDisplay"
                                            style="font-family: monospace; letter-spacing: 2px; background: var(--bg-card); padding: 4px 10px; border-radius: 6px; font-size: 0.85rem;">****</span>
                                        <button class="btn-icon-mini"
                                            onclick="{ const s = document.getElementById('currentPinDisplay'); if(s.textContent.includes('*')) { s.textContent = app.state.user.teamPin; this.innerHTML = '<i data-lucide=\'eye-off\'></i>'; } else { s.textContent = '****'; this.innerHTML = '<i data-lucide=\'eye\'></i>'; } lucide.createIcons(); }">
                                            <i data-lucide="eye" size="14"></i>
                                        </button>
                                    </div>
                                </div>
                                </button>
                            </div>

                            <div class="team-data-summary"
                                style="margin-top: 20px; background: rgba(var(--primary-rgb), 0.1); padding: 20px; border-radius: 20px; border: 1px solid var(--glass-border);">
                                <h4
                                    style="margin: 0 0 15px 0; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                                    <i data-lucide="key" size="16"></i> Deine Zugangsdaten
                                </h4>
                                <div style="display: flex; flex-direction: column; gap: 12px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-size: 0.85rem; opacity: 0.7;">Team-Schl√ºssel:</span>
                                        <span id="displayTeamKey"
                                            style="font-weight: 700; font-family: monospace; background: var(--bg-card); padding: 4px 10px; border-radius: 8px; font-size: 1rem; color: var(--primary);">---</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-size: 0.85rem; opacity: 0.7;">Privat-PIN:</span>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span id="displayTeamPin"
                                                style="font-weight: 700; font-family: monospace; background: var(--bg-card); padding: 4px 10px; border-radius: 8px; font-size: 1rem; color: var(--secondary);">****</span>
                                            <button class="btn-icon-mini"
                                                onclick="{ const s = document.getElementById('displayTeamPin'); if(s.textContent.includes('*')) { s.textContent = app.state.user.teamPin; this.innerHTML = '<i data-lucide=\'eye-off\'></i>'; } else { s.textContent = '****'; this.innerHTML = '<i data-lucide=\'eye\'></i>'; } lucide.createIcons(); }">
                                                <i data-lucide="eye" size="14"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <p style="margin: 15px 0 0 0; font-size: 0.75rem; opacity: 0.6; font-style: italic;">
                                    Gib diese Daten auf deinen anderen Ger√§ten ein, um dich zu verbinden.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div id="recentTeamsCard" class="card glass animate-in"
                        style="margin-top: 25px; padding: 25px; text-align: left; display: none;">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="history" size="18" style="color: var(--primary);"></i>
                            Zuletzt genutzte Teams
                        </h4>
                        <div id="recentTeamsList" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- JS populated -->
                        </div>
                    </div>

                    <div class="card glass animate-in"
                        style="margin-top: 25px; padding: 25px; text-align: left; border: 1px dashed rgba(var(--primary-rgb), 0.3);">
                        <h4
                            style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px; font-size: 0.9rem;">
                            <i data-lucide="terminal" size="16"></i>
                            Sync-Diagnose (Debug)
                        </h4>
                        <div id="syncLog"
                            style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; font-family: monospace; font-size: 0.75rem; color: #aaa; max-height: 100px; overflow-y: auto;">
                            Warte auf Aktion...
                        </div>
                    </div>

                    <div class="card glass animate-in" style="margin-top: 25px; padding: 25px; text-align: left;">
                        <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="info" size="18" style="color: var(--primary);"></i>
                            Wie funktioniert der Team-Sync?
                        </h4>
                        <ul
                            style="padding-left: 20px; color: var(--text-muted); font-size: 0.9rem; display: flex; flex-direction: column; gap: 8px;">
                            <li>Deine Daten werden sicher in der Cloud gespeichert.</li>
                            <li>W√§hle einen eindeutigen Team-Schl√ºssel.</li>
                            <li>Verwende den gleichen Schl√ºssel und PIN auf anderen Ger√§ten.</li>
                            <li>√Ñnderungen werden sofort auf allen angemeldeten Ger√§ten √ºbernommen.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="view-todo" class="page-view">
                <div class="hero">
                    <h1>Deine To-Do Liste üëã</h1>
                    <p>Plane deine Eink√§ufe und deinen Tag.</p>
                </div>

                <div class="todo-container glass animate-in">
                    <div class="todo-input-group"
                        style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px;">
                        <input type="text" id="todoInput"
                            style="width: 100%; height: 60px; font-size: 1.25rem; padding: 0 20px; border-radius: 16px; background-color: #ffffff !important; border: 2px solid var(--glass-border); color: #000000 !important; transition: var(--transition);"
                            placeholder="Was steht an? (z.B. Milch kaufen, Mail schreiben...)"
                            onkeyup="if(event.key === 'Enter') app.todo.add()">

                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <div style="flex: 1 1 200px; display: flex; gap: 8px;">
                                <select id="todoCategory"
                                    style="flex: 1; height: 50px; background: #ffffff; border: 1px solid var(--glass-border); border-radius: 12px; color: #000000; padding: 0 15px; font-weight: 500;">
                                    <!-- JS Populated -->
                                </select>
                                <button class="btn-outline" onclick="app.todo.addCategory()"
                                    style="height: 50px; width: 50px; border-radius: 12px; font-size: 1.5rem;"
                                    title="Neue Bezeichnung">+</button>
                            </div>
                            <label class="custom-checkbox-container"
                                style="display:flex; align-items:center; justify-content:center; gap:8px; background:rgba(239, 68, 68, 0.1); padding:0 15px; border-radius:12px; height:50px; border:1px solid rgba(239, 68, 68, 0.3); cursor:pointer; flex: 1 1 auto; min-width: 120px;">
                                <input type="checkbox" id="todoUrgent"
                                    style="width:20px; height:20px; accent-color:#ef4444;">
                                <span style="color:#ef4444; font-weight:600;">Dringend!</span>
                            </label>
                            <button class="btn-primary" onclick="app.todo.add()"
                                style="height: 50px; padding: 0 30px; font-size: 1.1rem; border-radius: 12px; flex: 1 1 150px; justify-content: center;">
                                <i data-lucide="plus" size="20"></i> Hinzuf√ºgen
                            </button>
                        </div>
                    </div>

                    <div class="todo-filters" style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="filter-btn active btn-outline" data-filter="all"
                            onclick="app.todo.setFilter('all')">Alle</button>
                        <button class="filter-btn btn-outline" data-filter="active"
                            onclick="app.todo.setFilter('active')">Offen</button>
                        <button class="filter-btn btn-outline" data-filter="completed"
                            onclick="app.todo.setFilter('completed')">Erledigt</button>
                    </div>

                    <div id="todoList" class="todo-list"
                        style="margin: 20px 0; display: flex; flex-direction: column; gap: 10px;">
                        <!-- JS populated -->
                    </div>

                    <div class="todo-footer"
                        style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--glass-border); padding-top: 15px;">
                        <span id="todoCount" class="text-muted">0 Aufgaben √ºbrig</span>
                        <button class="btn-text" onclick="app.todo.clearCompleted()">Erledigte l√∂schen</button>
                    </div>
                </div>
            </section>

            <section id="view-alarm" class="page-view">
                <div class="alarm-view-container glass animate-in" style="padding: 40px 20px;">
                    <div id="nightModeClock" class="digital-clock"
                        style="font-weight: 700; color: var(--primary); text-shadow: 0 0 20px var(--primary); margin-bottom: 30px; font-family: var(--font-main, 'Outfit', sans-serif); text-align: center;">
                        00:00:00
                    </div>

                    <div style="max-width: 600px; margin: 0 auto;">
                        <div class="alarm-adder glass"
                            style="margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.02);">
                            <h3 style="margin-bottom: 15px;">Neuen Wecker stellen</h3>
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                                <input type="time" id="newAlarmTime"
                                    style="font-size: 1.2rem; padding: 10px; border-radius: 10px; background: #ffffff; color: #000000; border: 1px solid var(--glass-border);">
                                <button class="btn-primary" onclick="app.alarm.add()" style="flex: 1;">Hinzuf√ºgen
                                    ‚è∞</button>
                            </div>
                            <div class="day-selector" style="display: flex; justify-content: space-between; gap: 5px;">
                                <label class="day-chip"><input type="checkbox" value="1" checked><span>Mo</span></label>
                                <label class="day-chip"><input type="checkbox" value="2" checked><span>Di</span></label>
                                <label class="day-chip"><input type="checkbox" value="3" checked><span>Mi</span></label>
                                <label class="day-chip"><input type="checkbox" value="4" checked><span>Do</span></label>
                                <label class="day-chip"><input type="checkbox" value="5" checked><span>Fr</span></label>
                                <label class="day-chip"><input type="checkbox" value="6"><span>Sa</span></label>
                                <label class="day-chip"><input type="checkbox" value="0"><span>So</span></label>
                            </div>
                        </div>

                        <div id="alarmList" style="display: flex; flex-direction: column; gap: 15px;">
                            <!-- Alarms list -->
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                        <div class="glass"
                            style="padding: 15px; text-align: center; display: flex; flex-direction: column; gap: 10px; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="autoNightclockAction" onchange="app.alarm.saveSettings()">
                                <label for="autoNightclockAction"
                                    style="font-size: 0.8rem; cursor: pointer; color: var(--text-muted);">Automatisch
                                    aktivieren</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 0.75rem; color: var(--text-muted);">Ab:</span>
                                <input type="time" id="nightModeStart" onchange="app.alarm.saveSettings()"
                                    style="background: #ffffff; border: 1px solid var(--glass-border); color: #000000; padding: 5px; border-radius: 5px; font-size: 0.8rem;">
                            </div>
                        </div>
                        <div class="glass"
                            style="padding: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="wakeLockCheck" onchange="app.alarm.toggleWakeLock()">
                                <span style="font-size: 0.8rem;">Bildschirm anlassen üì±</span>
                            </label>
                        </div>
                    </div>

                    <!-- Orientation Setting for Bedside Mode -->
                    <div class="glass"
                        style="margin-top: 15px; padding: 15px; display: flex; align-items: center; justify-content: space-between;">
                        <span style="font-size: 0.9rem; color: var(--text-muted);">Nachttisch-Format:</span>
                        <button class="btn-icon-mini" id="landscapeMainBtn" onclick="app.alarm.toggleLandscape()"
                            title="Format f√ºr Nachttisch w√§hlen"
                            style="background: rgba(var(--primary-rgb), 0.1); border-radius: 8px; width: 40px; height: 40px;">
                            <i data-lucide="layout-template" id="landscapeMainIcon"></i>
                        </button>
                    </div>

                    <div class="glass" style="margin-top: 15px; padding: 15px;">
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <label style="font-size: 0.9rem; color: var(--text-muted);">Helligkeit</label>
                            <input type="range" id="nightBrightness" min="0.1" max="1" step="0.1" value="1"
                                oninput="app.alarm.updateDesign('brightness', this.value)" style="width: 60%;">
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <label style="font-size: 0.9rem; color: var(--text-muted);">Farbe</label>
                            <div style="display:flex; gap:10px;">
                                <input type="color" id="nightColor" value="#ef4444"
                                    oninput="app.alarm.updateDesign('color', this.value)"
                                    style="background: transparent; border: none; height: 30px; width: 50px; cursor: pointer;">
                            </div>
                        </div>
                    </div>
                    <button class="btn-outline" onclick="app.alarm.toggleFullscreen()"
                        style="width: 100%; margin-top: 20px; padding: 15px;">
                        <i data-lucide="maximize" size="18"></i> Nachtuhr Modus (Vollbild)
                    </button>

                    <!-- Fullscreen Night Clock Overlay -->

            </section>

            <section id="view-settings" class="page-view">
                <div class="hero">
                    <h1>Einstellungen ‚öôÔ∏è</h1>
                    <p>Passe deinen MoltBot Organizer an.</p>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-bottom: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Mein Profil üë§</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <div class="profile-setup"
                            style="display: flex; gap: 20px; align-items: center; margin-bottom: 25px;">
                            <div id="avatarPreviewContainer" class="avatar-large"
                                style="position: relative; width: 100px; height: 100px; cursor: pointer; flex-shrink: 0;"
                                onclick="document.getElementById('userAvatarUpload').click()">
                                <img id="settingsUserAvatarPreview" src="logo.svg"
                                    style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%; border: 3px solid var(--primary);">
                                <div
                                    style="position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--bg-card);">
                                    <i data-lucide="camera" size="14"></i>
                                </div>
                                <input type="file" id="userAvatarUpload" hidden accept="image/*"
                                    onchange="app.handleAvatarUpload(this)">
                            </div>
                            <div>
                                <h4 style="margin: 0 0 5px 0;">Profilbild</h4>
                                <p class="text-muted" style="font-size: 0.8rem; margin: 0;">Klicke auf das Bild, um ein
                                    neues Foto hochzuladen oder √§ndere deinen Namen f√ºr einen neuen Avatar.</p>
                            </div>
                        </div>
                        <p class="text-muted" style="margin-bottom: 15px;">Passe deine pers√∂nlichen Informationen an.
                        </p>
                        <div class="settings-input-grid">
                            <div class="input-group">
                                <label>Dein Name</label>
                                <input type="text" id="settingsUserName" placeholder="Name eingeben..."
                                    onchange="app.updateUserName(this.value)">
                            </div>
                            <div class="input-group">
                                <label>Geburtsdatum</label>
                                <input type="date" id="settingsUserBirthday"
                                    onchange="app.updateUserData('birthday', this.value)">
                            </div>
                            <div class="input-group">
                                <label>Telefon</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="tel" id="settingsUserPhone" placeholder="Telefonnummer..."
                                        onchange="app.updateUserData('phone', this.value)" style="flex: 1;">
                                    <a id="settingsCallBtn" href="#" class="btn-icon-subtle hidden" title="Anrufen"
                                        style="color: var(--success);"><i data-lucide="phone" size="18"></i></a>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>E-Mail</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="email" id="settingsUserEmail" placeholder="E-Mail..."
                                        onchange="app.updateUserData('email', this.value)" style="flex: 1;">
                                    <a id="settingsMailBtn" href="#" class="btn-icon-subtle hidden"
                                        title="E-Mail schreiben" style="color: var(--primary);"><i data-lucide="mail"
                                            size="18"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="input-group" style="margin-top: 15px;">
                            <label>Adresse</label>
                            <input type="text" id="settingsUserAddress" placeholder="Deine Adresse..."
                                onchange="app.updateUserData('address', this.value)">
                        </div>
                        <div
                            style="margin-top: 25px; padding-top: 15px; border-top: 1px solid var(--glass-border); display: flex; justify-content: flex-end;">
                            <button class="icon-btn-subtle" onclick="app.resetUserProfile()"
                                style="color: var(--danger); gap: 8px; border-radius: 8px; padding: 10px 15px; font-weight: 600;">
                                <i data-lucide="refresh-cw" size="16"></i> Profil zur√ºcksetzen
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-bottom: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Erscheinungsbild üé®</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">


                        <p class="text-muted" style="margin-bottom: 15px;">W√§hle das Design, das dir am besten gef√§llt.
                        </p>
                        <div class="theme-selector-grid">
                            <button class="theme-btn" data-theme="dark" onclick="app.updateTheme('dark')">
                                <div class="theme-preview dark"></div>
                                <span>Dunkel</span>
                            </button>
                            <button class="theme-btn" data-theme="light" onclick="app.updateTheme('light')">
                                <div class="theme-preview light"></div>
                                <span>Hell</span>
                            </button>
                            <button class="theme-btn" data-theme="gold" onclick="app.updateTheme('gold')">
                                <div class="theme-preview gold" style="background: #d4af37;"></div>
                                <span>Gold</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-bottom: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Bildschirm & Anpassung üëÅÔ∏è</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 20px;">Passe Schriftart, Farben und Kontrast f√ºr
                            bessere Lesbarkeit an.</p>

                        <div class="settings-input-grid">
                            <div class="form-group">
                                <label>Schriftart</label>
                                <select id="settingsFont" onchange="app.updateVisualSetting('customFont', this.value)"
                                    style="width: 100%; padding: 12px; background: #ffffff; border: 1px solid var(--glass-border); border-radius: 12px; color: #000000;">
                                    <option value="Outfit">Standard (Outfit)</option>
                                    <option value="System">System (Arial/Helvetica)</option>
                                    <option value="Serif">Serif (Times/Georgia)</option>
                                    <option value="Mono">Monospace (Code)</option>
                                    <option value="Dyslexic">Open Dyslexic (Lesehilfe)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Hauptfarbe (Elemente)</label>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="color" id="settingsPrimaryColor"
                                        oninput="app.updateVisualSetting('customPrimary', this.value)"
                                        style="height: 45px; width: 100%; cursor: pointer; background: transparent; border: none;">
                                    <button class="btn-outline"
                                        onclick="app.updateVisualSetting('customPrimary', ''); document.getElementById('settingsPrimaryColor').value='#a1a1aa';"
                                        title="Zur√ºcksetzen">
                                        <i data-lucide="rotate-ccw"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Hintergrund-Farbe (Bereich)</label>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="color" id="settingsSecondaryColor"
                                        oninput="app.updateVisualSetting('customSecondary', this.value)"
                                        style="height: 45px; width: 100%; cursor: pointer; background: transparent; border: none;">
                                    <button class="btn-outline"
                                        onclick="app.updateVisualSetting('customSecondary', ''); document.getElementById('settingsSecondaryColor').value='#52525b';"
                                        title="Zur√ºcksetzen">
                                        <i data-lucide="rotate-ccw"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group"
                                style="grid-column: 1 / -1; display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="settingsHighContrast"
                                    onchange="app.updateVisualSetting('highContrastMode', this.checked)"
                                    style="width: 20px; height: 20px;">
                                <label for="settingsHighContrast">Einfacher Lesemodus (Maximaler Kontrast)</label>
                            </div>

                            <div class="form-group"
                                style="grid-column: 1 / -1; display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="settingsBoldMode"
                                    onchange="app.updateVisualSetting('boldMode', this.checked)"
                                    style="width: 20px; height: 20px;">
                                <label for="settingsBoldMode"><b>Fetter Text (Alles hervorheben)</b></label>
                            </div>
                        </div>

                        <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 20px;">
                            <div class="range-group">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <label>S√§ttigung</label>
                                    <span id="labelSat">100%</span>
                                </div>
                                <input type="range" id="inputSat" min="0" max="200" value="100"
                                    oninput="document.getElementById('labelSat').textContent = this.value + '%'; app.updateVisualSetting('globalSaturation', this.value)"
                                    style="width: 100%;">
                            </div>

                            <div class="range-group">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <label>Kontrast</label>
                                    <span id="labelCon">100%</span>
                                </div>
                                <input type="range" id="inputCon" min="50" max="200" value="100"
                                    oninput="document.getElementById('labelCon').textContent = this.value + '%'; app.updateVisualSetting('globalContrast', this.value)"
                                    style="width: 100%;">
                            </div>

                            <div class="range-group">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <label>Helligkeit</label>
                                    <span id="labelBri">100%</span>
                                </div>
                                <input type="range" id="inputBri" min="50" max="150" value="100"
                                    oninput="document.getElementById('labelBri').textContent = this.value + '%'; app.updateVisualSetting('globalBrightness', this.value)"
                                    style="width: 100%;">
                            </div>

                            <div class="range-group">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <label>Schriftgr√∂√üe</label>
                                    <span id="labelFontScale">100%</span>
                                </div>
                                <input type="range" id="inputFontScale" min="70" max="150" value="100"
                                    oninput="document.getElementById('labelFontScale').textContent = this.value + '%'; app.updateVisualSetting('fontSizeScale', this.value)"
                                    style="width: 100%;">
                            </div>

                            <div
                                style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                                <h4 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    <i data-lucide="mic" size="18"></i> Sprachsteuerung
                                </h4>
                                <label
                                    style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 12px; cursor: pointer; border: 1px solid var(--glass-border);">
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">"Hey Pear" Aktivierung</div>
                                        <div style="font-size: 0.85rem; color: var(--text-muted);">Kontinuierliches
                                            H√∂ren auf das Wake Word</div>
                                    </div>
                                    <input type="checkbox" id="wakeWordToggle"
                                        onchange="if(this.checked) { app.voice.startWakeWord(); } else { app.voice.stopWakeWord(); }"
                                        style="width: 20px; height: 20px; accent-color: var(--primary); cursor: pointer;">
                                </label>
                                <p
                                    style="font-size: 0.75rem; color: var(--text-muted); margin-top: 10px; font-style: italic;">
                                    üí° Wenn aktiviert, h√∂rt die App kontinuierlich auf "Pear" und aktiviert dann die
                                    Sprachsteuerung automatisch.
                                </p>
                            </div>

                            <button class="btn-outline" onclick="app.resetVisuals()"
                                style="margin-top: 15px; border-color: var(--danger); color: var(--danger);">
                                <i data-lucide="rotate-ccw"></i> Einstellungen zur√ºcksetzen
                            </button>
                        </div>
                    </div>
                    <div class="card glass animate-in collapsible-card is-collapsed" style="margin-bottom: 25px;">
                        <div class="card-header-toggle" onclick="app.toggleCard(this)">
                            <h3>Finanzen & Budget üí∞</h3>
                            <i data-lucide="chevron-down" class="toggle-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="text-muted" style="margin-bottom: 20px;">Lege dein monatliches Budget (Gehalt) und
                                die
                                Warn-Schwelle fest.</p>
                            <div class="settings-input-grid">
                                <div class="input-group">
                                    <label>Netto-Gehalt (Monatsbudget)</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="number" id="settingsMonthlyBudget" placeholder="1000.00"
                                            onchange="{ app.state.monthlyBudget = parseFloat(this.value) || 0; localStorage.setItem('moltbot_budget', app.state.monthlyBudget); app.finance.render(); }">
                                        <div
                                            style="height: 45px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); padding: 0 15px; border-radius: 12px; border: 1px solid var(--glass-border);">
                                            ‚Ç¨</div>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Warnung bei Restbetrag</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="number" id="settingsBudgetWarning" placeholder="100.00"
                                            onchange="{ app.state.budgetWarningLimit = parseFloat(this.value) || 0; localStorage.setItem('moltbot_budget_warning', app.state.budgetWarningLimit); app.finance.render(); }">
                                        <div
                                            style="height: 45px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); padding: 0 15px; border-radius: 12px; border: 1px solid var(--glass-border);">
                                            ‚Ç¨</div>
                                    </div>
                                </div>
                            </div>
                            <div class="input-group" style="grid-column: 1 / -1; margin-top: 10px;">
                                <div
                                    style="background: rgba(var(--primary-rgb), 0.1); border: 1px solid rgba(var(--primary-rgb), 0.2); padding: 12px; border-radius: 12px; display: flex; align-items: center; gap: 12px;">
                                    <i data-lucide="mic" style="color: var(--primary);"></i>
                                    <p style="font-size: 0.8rem; margin: 0; opacity: 0.9;">
                                        <strong>Pro-Tipp:</strong> Du kannst dein Budget auch per Sprache setzen! Sag
                                        einfach: <em>"Pear, setze mein Gehalt auf 2000 Euro"</em>.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card" style="margin-bottom: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>App installieren & Teilen üì±</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 20px;">Installiere Pear als App auf deinem
                            Startbildschirm oder sende sie an Freunde & Familie.</p>

                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <button id="pwaInstallBtn" class="btn-primary w-full" onclick="app.installApp()"
                                style="display: none; height: 55px; border-radius: 16px; font-weight: 700;">
                                <i data-lucide="download"></i> PEAR APP INSTALLIEREN
                            </button>

                            <button class="btn-outline w-full" onclick="app.shareApp()"
                                style="height: 55px; border-radius: 16px; font-weight: 600; background: rgba(var(--primary-rgb), 0.1);">
                                <i data-lucide="share-2"></i> App mit anderen teilen
                            </button>

                            <div
                                style="background: rgba(var(--secondary-rgb), 0.05); padding: 15px; border-radius: 16px; border: 1px solid var(--glass-border);">
                                <h4
                                    style="font-size: 0.9rem; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                    <i data-lucide="smartphone"></i> Manuelle Installation
                                </h4>
                                <ol
                                    style="padding-left: 20px; font-size: 0.85rem; color: var(--text-muted); display: flex; flex-direction: column; gap: 5px;">
                                    <li>√ñffne Pear in deinem Browser (Chrome/Safari).</li>
                                    <li>Tippe auf das <b>Teilen-Icon</b> (iOS) oder die <b>drei Punkte</b> (Android).
                                    </li>
                                    <li>W√§hle <b>"Zum Home-Bildschirm hinzuf√ºgen"</b>.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Copyright Notice -->
                <div class="card glass animate-in"
                    style="margin-bottom: 25px; border: 2px solid rgba(var(--primary-rgb), 0.3); background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), rgba(var(--secondary-rgb), 0.05));">
                    <div style="text-align: center; padding: 10px 0;">
                        <div
                            style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 15px;">
                            <i data-lucide="shield-check" size="24" style="color: var(--primary);"></i>
                            <h3 style="margin: 0; font-size: 1.3rem;">Copyright & Lizenz</h3>
                        </div>

                        <div
                            style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 16px; margin-bottom: 15px;">
                            <p style="font-size: 1.1rem; font-weight: 600; margin: 0 0 8px 0; color: var(--text-main);">
                                MoltBot Organizer / Pear App
                            </p>
                            <p style="font-size: 0.95rem; margin: 0; color: var(--text-muted);">
                                <i data-lucide="copyright" size="14"
                                    style="display: inline; vertical-align: middle;"></i>
                                Copyright ¬© 2026 <strong style="color: var(--primary);">Andrea Agnello</strong>
                            </p>
                            <p style="font-size: 0.95rem; margin: 5px 0 0 0; color: var(--text-muted);">
                                <i data-lucide="building-2" size="14"
                                    style="display: inline; vertical-align: middle;"></i>
                                <strong style="color: var(--primary);">Pear Company</strong>, Deutschland
                            </p>
                        </div>

                        <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0; font-style: italic;">
                            Alle Rechte vorbehalten. All rights reserved.
                        </p>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Listen & Bezeichnungen</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 15px;">Hier kannst du deine Bezeichnungen f√ºr
                            Aufgaben
                            verwalten und l√∂schen.</p>
                        <div id="categoryManager"
                            style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-top: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Feiertage (BW) üá©üá™</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 15px;">Automatisch berechnete Feiertage f√ºr das
                            aktuelle Jahr.</p>
                        <div id="settingsHolidayList" style="display: flex; flex-direction: column; gap: 8px;">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-top: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Finanz-Archiv üì¶</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 15px;">Archivierte Transaktionen aus vergangenen
                            Monaten. Diese werden automatisch am 1. jeden Monats archiviert.</p>
                        <div id="financeArchiveList"
                            style="display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto;">
                            <div class="empty-state">Keine archivierten Eintr√§ge vorhanden.</div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn-outline" onclick="app.finance.renderArchive()" style="flex: 1;">
                                <i data-lucide="refresh-cw"></i> Aktualisieren
                            </button>
                            <button class="btn-outline" onclick="app.finance.clearArchive()" style="flex: 1;">
                                <i data-lucide="trash-2"></i> Archiv leeren
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card glass animate-in collapsible-card is-collapsed" style="margin-top: 25px;">
                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Schnellzugriff & Dock üöÄ</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 20px;">W√§hle dein bevorzugtes Design f√ºr die untere
                            Steuerungsleiste und passe die Reihenfolge der Men√ºpunkte an.</p>

                        <div class="settings-input-grid" style="margin-bottom: 20px;">
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>Dock Modus</label>
                                <select id="settingsDockStyle" onchange="app.updateDockStyle(this.value)">
                                    <option value="compact">Kompakt (3 Buttons)</option>
                                    <option value="full">Vollst√§ndig (Alle Module)</option>
                                </select>
                            </div>
                        </div>

                        <div id="quickActionSettings" class="settings-input-grid" style="margin-bottom: 25px;">
                            <div class="form-group">
                                <label>Linker Button</label>
                                <select id="settingsQALeft" onchange="app.updateQuickAction('Left', this.value)">
                                    <option value="dashboard">Dashboard</option>
                                    <option value="calendar">Kalender</option>
                                    <option value="finance">Finanzen</option>
                                    <option value="team">Team Sync</option>
                                    <option value="contacts">Kontakte</option>
                                    <option value="todo">Aufgaben</option>
                                    <option value="alarm">Wecker</option>
                                    <option value="settings">Einstellungen</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Rechter Button</label>
                                <select id="settingsQARight" onchange="app.updateQuickAction('Right', this.value)">
                                    <option value="dashboard">Dashboard</option>
                                    <option value="calendar">Kalender</option>
                                    <option value="finance">Finanzen</option>
                                    <option value="team">Team Sync</option>
                                    <option value="contacts">Kontakte</option>
                                    <option value="todo">Aufgaben</option>
                                    <option value="alarm">Wecker</option>
                                    <option value="settings">Einstellungen</option>
                                </select>
                            </div>
                        </div>

                        <div id="menuOrderSettings" style="margin-top: 25px;">
                            <h4
                                style="font-size: 0.9rem; font-weight: 700; margin-bottom: 15px; color: var(--text-main);">
                                <i data-lucide="move" size="16" style="vertical-align: middle;"></i>
                                Men√º-Reihenfolge anpassen
                            </h4>
                            <p class="text-muted" style="margin-bottom: 15px; font-size: 0.85rem;">
                                Ziehe die Eintr√§ge, um die Reihenfolge im Dock zu √§ndern. Die Standardreihenfolge
                                entspricht dem Hamburger-Men√º.
                            </p>
                            <div id="menuOrderList"
                                style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;">
                                <!-- Dynamically populated by JS: app.renderMenuOrderSettings() -->
                            </div>
                            <button class="btn-outline" onclick="app.resetMenuOrder()"
                                style="width: 100%; margin-top: 10px;">
                                <i data-lucide="rotate-ccw" size="16"></i>
                                Standardreihenfolge wiederherstellen
                            </button>
                        </div>

                        <div class="settings-hint"
                            style="font-size: 0.8rem; color: var(--text-muted); display:flex; gap:10px; align-items:center; margin-top: 20px;">
                            <i data-lucide="info" size="14"></i>
                            √Ñnderungen werden sofort √ºbernommen und auf allen Ger√§ten synchronisiert.
                        </div>
                    </div>
                </div>

                <div class="card glass secondary animate-in collapsible-card is-collapsed" style="margin-top: 25px;">

                    <div class="card-header-toggle" onclick="app.toggleCard(this)">
                        <h3>Dashboard-Anpassung ‚öôÔ∏è</h3>
                        <i data-lucide="chevron-down" class="toggle-icon"></i>
                    </div>
                    <div class="card-content">
                        <p class="text-muted" style="margin-bottom: 20px;">Personalisiere dein Dashboard: √Ñndere die
                            Reihenfolge oder blende Bereiche ein/aus.</p>

                        <div id="widgetOrderList"
                            style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px;">
                            <!-- Dynamically populated by JS: app.renderWidgetSettings() -->
                        </div>

                        <div class="settings-hint"
                            style="font-size: 0.8rem; color: var(--text-muted); display:flex; gap:10px; align-items:center;">
                            <i data-lucide="info" size="14"></i>
                            Jede √Ñnderung wird sofort auf deinem Dashboard √ºbernommen.
                        </div>
                    </div>

                </div>
            </section>


            <section id="view-contacts" class="page-view">
                <div class="hero">
                    <h1>Meine Kontakte üë•</h1>
                    <p>Verwalte deine Freunde und Familie.</p>
                </div>

                <div class="quick-contacts-bar glass animate-in" style="margin-bottom: 20px; padding: 15px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4
                            style="font-size: 0.8rem; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; margin: 0;">
                            Favoriten ‚ù§Ô∏è</h4>
                        <button class="icon-btn" id="toggleFavsBtn" onclick="app.toggleFavorites()"
                            style="width: 24px; height: 24px;">
                            <i data-lucide="chevron-up"></i>
                        </button>
                    </div>
                    <div class="quick-contact-grid" id="quickContactsContainer">
                        <!-- JS Populated -->
                    </div>
                </div>

                <div class="contacts-toolbar-new animate-in">
                    <div class="contacts-search-row">
                        <div class="search-bar-modern">
                            <i data-lucide="search"></i>
                            <input type="text" id="contactSearch" placeholder="Kontakte suchen..."
                                oninput="app.contacts.render()">
                        </div>
                    </div>

                    <div class="contacts-actions-row-modern">
                        <button class="btn-add-modern" onclick="app.contacts.openModal()">
                            <i data-lucide="user-plus"></i> <span>Hinzuf√ºgen</span>
                        </button>

                        <div class="secondary-actions">
                            <button class="btn-icon-modern" onclick="app.contacts.importMobile()"
                                title="Vom Handy importieren">
                                <i data-lucide="smartphone"></i>
                            </button>

                            <div class="view-switch-modern" id="contactViewSelector">
                                <button data-view="cards" title="Raster"><i data-lucide="layout-grid"></i></button>
                                <button data-view="table" title="Liste"><i data-lucide="list"></i></button>
                            </div>

                            <details class="contacts-more-dropdown">
                                <summary class="btn-icon-modern">
                                    <i data-lucide="more-horizontal"></i>
                                </summary>
                                <div class="glass dropdown-menu-modern">
                                    <button onclick="this.closest('details').removeAttribute('open'); app.sync.push()">
                                        <i data-lucide="refresh-cw"></i> Cloud Sync
                                    </button>
                                    <label>
                                        <i data-lucide="file-input"></i> Datei (VCF/CSV)
                                        <input type="file" id="contactImportFile" accept=".vcf,.csv"
                                            style="display: none;"
                                            onchange="this.closest('details').removeAttribute('open'); app.contacts.import(this)">
                                    </label>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>

                <div id="contactMainContainer" class="animate-in">
                    <!-- Populated by JS as either table or cards -->
                </div>
            </section>

        </main> <!-- End of Main Content -->

        <!-- Feedback FAB (Point 9) -->
        <button class="feedback-fab" onclick="app.showFeedback()" title="Feedback geben">
            <i data-lucide="message-square"></i>
        </button>

        <!-- Modals -->
        <div class="modal-overlay hidden" id="modalOverlay">
            <div class="modal glass">
                <div class="modal-header">
                    <h2 id="modalTitle">Neuer Termin</h2>
                    <button class="close-modal" id="closeModalBtn"><i data-lucide="x"></i></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <div class="form-group">
                            <label>Titel</label>
                            <input type="text" id="eventTitle" placeholder="Meeting, Arzt, Sport..." required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Datum</label>
                                <input type="date" id="eventDate" required>
                            </div>
                            <div class="form-group">
                                <label>Uhrzeit</label>
                                <input type="time" id="eventTime">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Ort / Adresse</label>
                            <input type="text" id="eventLocation" placeholder="M√ºnchen, Marienplatz...">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Telefon</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="tel" id="eventPhone" placeholder="+49..." style="flex: 1;">
                                    <a id="eventCallBtn" href="#" class="btn-icon-subtle hidden" title="Anrufen"
                                        style="color: var(--success);"><i data-lucide="phone" size="18"></i></a>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>E-Mail</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="email" id="eventEmail" placeholder="kontakt@beispiel.de"
                                        style="flex: 1;">
                                    <a id="eventMailBtn" href="#" class="btn-icon-subtle hidden"
                                        title="E-Mail schreiben" style="color: var(--primary);"><i data-lucide="mail"
                                            size="18"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Notizen</label>
                            <textarea id="eventNotes" placeholder="Details zum Termin..."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label>Wiederholung</label>
                                <select id="eventRecurrence">
                                    <option value="none">Keine</option>
                                    <option value="daily">T√§glich</option>
                                    <option value="weekly">W√∂chentlich</option>
                                    <option value="monthly">Monatlich</option>
                                    <option value="yearly">J√§hrlich (Jahrestag)</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Kategorie</label>
                                <select id="eventCategory">
                                    <option value="work">Arbeit</option>
                                    <option value="private">Privat</option>
                                    <option value="urgent">Dringend</option>
                                    <option value="birthday">Geburtstag üéÇ</option>
                                    <option value="holiday">Feiertag üéä</option>
                                    <option value="reminder">Erinnerung</option>
                                </select>
                            </div>
                            <div class="form-group" style="width: 80px;">
                                <label>Farbe</label>
                                <input type="color" id="eventColor" value="#6366f1"
                                    style="height: 42px; width: 100%; padding: 2px; cursor: pointer;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button type="button" id="deleteEventBtn" class="btn-outline"
                                style="flex: 1; border-color: var(--danger); color: var(--danger); display: none;"
                                onclick="app.deleteEvent()">L√∂schen</button>
                            <button type="submit" class="btn-primary" style="flex: 2;">Speichern</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <!-- Contact Modal -->
        <div class="modal-overlay hidden" id="contactModalOverlay">
            <div class="modal glass">
                <div class="modal-header">
                    <h2 id="contactModalTitle">Kontakt hinzuf√ºgen</h2>
                    <button class="close-modal" id="closeContactModalBtn"><i data-lucide="x"></i></button>
                </div>
                <div class="modal-body">
                    <form id="contactForm">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="contactName" placeholder="Max M√ºller" required>
                        </div>
                        <div class="form-group">
                            <label>Telefon</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="tel" id="contactPhone" placeholder="+49 123 456789" style="flex: 1;">
                                <a id="contactCallBtn" href="#" class="btn-icon-subtle hidden" title="Anrufen"
                                    style="color: var(--success);">
                                    <i data-lucide="phone" size="18"></i>
                                </a>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>E-Mail</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="email" id="contactEmail" placeholder="max@beispiel.de" style="flex: 1;">
                                <a id="contactMailBtn" href="#" class="btn-icon-subtle hidden" title="E-Mail schreiben"
                                    style="color: var(--primary);">
                                    <i data-lucide="mail" size="18"></i>
                                </a>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Adresse</label>
                            <input type="text" id="contactAddress" placeholder="Musterstra√üe 1, Berlin">
                        </div>
                        <div class="form-group">
                            <label>Geburtsdatum</label>
                            <input type="date" id="contactBirthday">
                        </div>
                        <div class="form-group">
                            <label>Notizen</label>
                            <textarea id="contactNotes" placeholder="Zus√§tzliche Infos..."
                                style="height: 60px;"></textarea>
                        </div>
                        <div class="form-group" style="display:flex; gap:20px; flex-wrap:wrap;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="contactIsFavorite" style="width: auto;">
                                Favorit ‚ù§Ô∏è
                            </label>
                            <label
                                style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: #ef4444; font-weight:600;">
                                <input type="checkbox" id="contactIsUrgent" style="width: auto; accent-color: #ef4444;">
                                Dringend! üö®
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" id="deleteContactBtn" class="btn-outline"
                                style="flex: 1; border-color: var(--danger); color: var(--danger); display: none;"
                                onclick="app.contacts.delete()">L√∂schen</button>
                            <button type="submit" class="btn-primary" style="flex: 2;">Speichern</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- Hamburger Menu is now the primary mobile navigation -->

        <!-- Bottom Navigation Bar (Mobile & Tablet) -->
        <div class="voice-dock">
            <button class="voice-side-btn" data-page="dashboard" onclick="app.navigateTo('dashboard')"
                title="Dashboard"><i data-lucide="layout-dashboard"></i></button>
            <button class="voice-side-btn" data-page="calendar" onclick="app.navigateTo('calendar')" title="Kalender"><i
                    data-lucide="calendar"></i></button>
            <button class="voice-side-btn" data-page="finance" onclick="app.navigateTo('finance')" title="Finanzen"><i
                    data-lucide="wallet"></i></button>
            <button class="voice-side-btn" data-page="todo" onclick="app.navigateTo('todo')" title="Aufgaben"><i
                    data-lucide="check-square"></i></button>

            <button id="voiceControlBtn" class="voice-btn" onclick="app.voice.start()" title="Sprachsteuerung"><i
                    data-lucide="mic"></i></button>

            <button class="voice-side-btn" data-page="alarm" onclick="app.navigateTo('alarm')" title="Wecker"><i
                    data-lucide="clock"></i></button>
            <button class="voice-side-btn" data-page="team" onclick="app.navigateTo('team')" title="Team Sync"><i
                    data-lucide="users"></i></button>
            <button class="voice-side-btn" data-page="contacts" onclick="app.navigateTo('contacts')" title="Kontakte"><i
                    data-lucide="contact"></i></button>
            <button class="voice-side-btn" data-page="settings" onclick="app.navigateTo('settings')"
                title="Einstellungen"><i data-lucide="settings"></i></button>
        </div>




        <!-- Pear AI Voice & Intelligence Overlay -->
        <div id="voiceOverlay" class="voice-overlay hidden">
            <div class="ai-orb-container">
                <div class="ai-orb"></div>
                <div class="ai-orb-blur"></div>
            </div>

            <div class="voice-content ai-premium-content">
                <div class="ai-badge">PEAR AI ASSISTANT</div>
                <h2 id="aiStatusTitle">Wie kann ich dir helfen?</h2>

                <div class="transcript-container glass">
                    <p id="voiceTranscript" class="transcript">Sage z.B. "Erinnere mich an das Meeting morgen" oder "Wie
                        ist mein Budget?"</p>
                </div>

                <div class="ai-visualizer">
                    <div class="ai-bar"></div>
                    <div class="ai-bar"></div>
                    <div class="ai-bar"></div>
                    <div class="ai-bar"></div>
                    <div class="ai-bar"></div>
                </div>

                <div class="ai-controls">
                    <button class="btn-outline ai-btn-close" onclick="app.voice.stop()">
                        <i data-lucide="x" size="20"></i> Schlie√üen
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Quick Expense Modal -->
    <div class="modal-overlay hidden" id="quickExpenseModal"
        style="background: rgba(24, 24, 27, 0.85); backdrop-filter: blur(8px); z-index: 10000;">
        <div class="modal-card animate-in"
            style="max-width: 550px; background: var(--bg-card); border-radius: var(--radius-lg); padding: 30px; border: 1px solid var(--glass-border); box-shadow: var(--card-shadow); margin: auto; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="border: none; padding: 0 0 20px 0;">
                <h3 style="color: var(--text-main); font-size: 1.5rem; font-weight: 800;">Ausgabe hinzuf√ºgen</h3>
                <button class="btn-icon" onclick="document.getElementById('quickExpenseModal').classList.add('hidden')"
                    style="color: var(--text-main); background: var(--bg-hover);">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <form id="quickExpenseForm" onsubmit="app.finance.saveQuickAdd(event)"
                    style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="input-group">
                            <label
                                style="color: var(--text-muted); font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; display: block;">Betrag
                                (‚Ç¨)</label>
                            <input type="number" id="quickFinAmount" step="0.01" required placeholder="0.00" autoFocus
                                style="width: 100%; font-size: 1rem; padding: 12px 16px; border-radius: 12px; background: var(--bg-element); border: 1px solid var(--glass-border); color: var(--text-main); transition: border-color 0.2s;">
                        </div>
                        <div class="input-group">
                            <label
                                style="color: var(--text-muted); font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; display: block;">Datum</label>
                            <input type="date" id="quickFinDate" required
                                style="width: 100%; font-size: 1rem; padding: 12px 16px; border-radius: 12px; background: var(--bg-element); border: 1px solid var(--glass-border); color: var(--text-main); transition: border-color 0.2s;">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="input-group">
                            <label
                                style="color: var(--text-muted); font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; display: block;">Typ</label>
                            <select id="quickFinType"
                                style="width: 100%; font-size: 1rem; padding: 12px 16px; border-radius: 12px; background: var(--bg-element); border: 1px solid var(--glass-border); color: var(--text-main); transition: border-color 0.2s;">
                                <option value="expense">Ausgabe</option>
                                <option value="income">Einnahme</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label
                                style="color: var(--text-muted); font-weight: 700; font-size: 0.9rem; margin-bottom: 8px; display: block;">Beschreibung</label>
                            <input type="text" id="quickFinSource" placeholder="z.B. Gehalt, Miete..." required
                                style="width: 100%; font-size: 1rem; padding: 12px 16px; border-radius: 12px; background: var(--bg-element); border: 1px solid var(--glass-border); color: var(--text-main); transition: border-color 0.2s;">
                        </div>
                    </div>
                    <button type="submit" class="btn-primary"
                        style="padding: 16px; font-weight: 700; font-size: 1.1rem; border-radius: 15px; margin-top: 10px; background: #002a46; color: #ffffff; border: none; box-shadow: 0 4px 12px rgba(0,42,70,0.2);">
                        Eintragen
                    </button>
                </form>
            </div>
        </div>
    </div>


    <!-- Fullscreen Night Clock Overlay (Moved to root level) -->
    <div id="nightClockFullscreen" class="night-overlay hidden" onclick="app.alarm.toggleFullscreen()">
        <!-- Explicit power-off button for better usability -->
        <button class="night-close-btn" onclick="event.stopPropagation(); app.alarm.toggleFullscreen(false)"
            title="Nachtuhr beenden">
            <i data-lucide="power"></i>
        </button>

        <div class="night-clock-large" id="fullscreenClock">00:00</div>
        <div class="night-clock-date" id="fullscreenDate">Freitag, 6. Februar</div>

        <!-- Controls visible on hover/tap -->
        <div class="night-controls" onclick="event.stopPropagation()">
            <div class="control-group">
                <i data-lucide="sun" size="16"></i>
                <input type="range" id="fsBrightness" min="0.1" max="1" step="0.1"
                    oninput="app.alarm.updateDesign('brightness', this.value)">
            </div>
            <div class="control-group">
                <i data-lucide="palette" size="16"></i>
                <input type="color" id="fsColor" oninput="app.alarm.updateDesign('color', this.value)">
            </div>
            <div class="control-group" onclick="app.alarm.toggleLandscape()"
                style="cursor:pointer; background: rgba(255,255,255,0.08); padding: 8px 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);">
                <i data-lucide="layout-template" size="16"></i>
                <span id="landscapeToggleText" style="font-size: 0.8rem; font-weight: 600;">Nachttisch-Format</span>
            </div>
        </div>

        <div class="night-hint">Tippen zum Beenden</div>
    </div>

    </div> <!-- End of #app -->

    <script src="app.js"></script>
    <script src="enhanced-dashboard.js"></script>
    <script src="premium-todo-integration.js"></script>
</body>

</html>